pipeline {
  agent any

  parameters {
    string(description: 'Branch to build', name: 'branch',)
    string(description: 'IP Address', name: 'IP_ADDRESS')
    string(description: 'Username', name: 'USERNAME') 
  }

  stages {
    stage('Clone') {
      steps {
        git credentialsId: 'gitlab', url: 'https://pexgit.growipx.com/supportfirst/supportfirst-api-service.git', branch: "${params.branch}"
      }
    }
    stage('Maven Build') {
      steps {
        script {
          def mvnHome = tool name: 'Maven', type: 'maven'
          sh "${mvnHome}/bin/mvn clean install"
        }
      }
    }
    stage('Check dir') { 
      steps{
        sh 'pwd'
        sh 'ls -la /var/lib/jenkins/workspace/testiopex/'
      }
    }
    stage('Whoami') { 
      steps {
        sh 'whoami'
        sh 'pwd'
      }
    }
    stage('Jar') {
      steps {
        sh 'whoami'
      }
    }
    stage('SCP File transfer'){
      steps{
        def targetDir = '/opt/supportfirst/'  
        script {
          sh """
          scp -T -P 7774 -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/testiopex/target/supportfirst-api-service-0.0.1.war ${params.USERNAME}@${params.IP_ADDRESS}:${targetDir}
          """
        }
      }
    }
    stage ('LOG'){ 
      steps{
        // sh 'nohup java -jar ./target/supportfirst-api-service-0.0.1.war &'  
      }
    }
    stage ('SSH'){
      steps{
        def targetDir = '/opt/supportfirst/' 
        sh """
        ssh -p 7774 ${params.USERNAME}@${params.IP_ADDRESS} 'cd ${targetDir} && nohup java -jar supportfirst-api-service-0.0.1.war &'
        """
      }
    }
    stage ('Run'){ // Optional stage for verification on remote server
      steps{
        // sh 'hostname -I'  
        // sh 'ls -l'       
      }
    }
  }
}
Started by user admin
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
WorkflowScript: 43: Expected a step @ line 43, column 9.
           def targetDir = '/opt/supportfirst/'  
           ^

WorkflowScript: 58: Expected a step @ line 58, column 9.
           def targetDir = '/opt/supportfirst/' 
           ^

WorkflowScript: 52: No steps specified for branch @ line 52, column 12.
         steps{
              ^

WorkflowScript: 65: No steps specified for branch @ line 65, column 12.
         steps{
              ^

4 errors

	at org.codehaus.groovy.control.ErrorCollector.failIfErrors(ErrorCollector.java:309)
	at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:1107)
	at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:624)
	at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:602)
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:579)
	at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:323)
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:293)
	at org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox$Scope.parse(GroovySandbox.java:163)
	at org.jenkinsci.plugins.workflow.cps.CpsGroovyShell.doParse(CpsGroovyShell.java:190)
	at org.jenkinsci.plugins.workflow.cps.CpsGroovyShell.reparse(CpsGroovyShell.java:175)
	at org.jenkinsci.plugins.workflow.cps.CpsFlowExecution.parseScript(CpsFlowExecution.java:635)
	at org.jenkinsci.plugins.workflow.cps.CpsFlowExecution.start(CpsFlowExecution.java:581)
	at org.jenkinsci.plugins.workflow.job.WorkflowRun.run(WorkflowRun.java:335)
	at hudson.model.ResourceController.execute(ResourceController.java:101)
	at hudson.model.Executor.run(Executor.java:442)
Finished: FAILURE
